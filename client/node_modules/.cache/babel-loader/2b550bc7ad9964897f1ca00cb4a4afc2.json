{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gpsha\\\\Downloads\\\\vaccine-dapp-main\\\\vaccine-dapp-main\\\\client\\\\src\\\\contexts\\\\EthContext\\\\EthProvider.jsx\",\n  _s = $RefreshSig$();\nimport React, { useReducer, useCallback, useEffect, useState } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport { ToastContainer, toast } from 'react-toastify';\nimport { Spinner } from '../../components/Shared';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction EthProvider({\n  children\n}) {\n  _s();\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const [loader, showloader] = useState(false);\n  const listenToTheViolationEvents = useCallback(contract => {\n    var _contract$events;\n    console.log(\"insideviolation\");\n    contract === null || contract === void 0 ? void 0 : (_contract$events = contract.events) === null || _contract$events === void 0 ? void 0 : _contract$events.ViolationEvent().on(\"data\", async evt => {\n      if (evt.returnValues) {\n        console.log(evt);\n        switch (evt.returnValues.vio_type) {\n          case \"1\":\n            return toast.warning(\"Temprature of the container violated\");\n          case \"2\":\n            return toast.warning(\"Container opened while on track\");\n          case \"3\":\n            return toast.warning(\"Container has been exposed to light\");\n          case \"4\":\n            return toast.warning(\"Container got sidetracked\");\n          default:\n            return toast.error(\"Something went wrong\");\n        }\n        //  alert(evt)\n      }\n    });\n  });\n  const listenToTheVaccineEvent = useCallback(contract => {\n    var _contract$events2;\n    console.log(contract, \"inside vaccine event\");\n    contract === null || contract === void 0 ? void 0 : (_contract$events2 = contract.events) === null || _contract$events2 === void 0 ? void 0 : _contract$events2.VaccineChainStep().on(\"data\", async evt => {\n      if (evt.returnValues) {\n        console.log(evt);\n        switch (await evt.returnValues.step) {\n          case \"0\":\n            return toast.success(\"Not ready for Delivery\");\n          case \"1\":\n            return toast.success(\"Container created and ready for delivery\");\n          case \"2\":\n            return toast.success(\"Container is on its track\");\n          case \"3\":\n            return toast.success(\"Delivery of container has been ended\");\n          case \"4\":\n            return toast.success(\"Container has been received\");\n          default:\n            return toast.error(\"Something went wrong\");\n        }\n        //  alert(evt)\n      }\n    });\n  });\n  const init = useCallback(async artifact => {\n    if (artifact) {\n      const web3 = new Web3(Web3.givenProvider || \"ws://localhost:7545\");\n      const accounts = await web3.eth.requestAccounts();\n      const networkID = await web3.eth.net.getId();\n      const vaccines = [];\n      console.log(accounts, \"accounts\");\n      const {\n        abi\n      } = artifact;\n      let address, contract;\n      try {\n        var _contract, _contract$methods;\n        showloader(true);\n        address = artifact.networks[networkID].address;\n        contract = new web3.eth.Contract(abi, address);\n        listenToTheVaccineEvent(contract);\n        const vaccineCount = await ((_contract = contract) === null || _contract === void 0 ? void 0 : (_contract$methods = _contract.methods) === null || _contract$methods === void 0 ? void 0 : _contract$methods.vaccineCount().call({\n          from: accounts[0]\n        }));\n        for (let i = 0; i < vaccineCount; i++) {\n          var _contract2, _contract2$methods, _contract2$methods$va;\n          const res = await ((_contract2 = contract) === null || _contract2 === void 0 ? void 0 : (_contract2$methods = _contract2.methods) === null || _contract2$methods === void 0 ? void 0 : (_contract2$methods$va = _contract2$methods.vaccine(i)) === null || _contract2$methods$va === void 0 ? void 0 : _contract2$methods$va.call({\n            from: accounts[0]\n          }));\n          vaccines.push({\n            id: res.id,\n            name: res.name,\n            state: res.state\n          });\n        }\n        showloader(false);\n        listenToTheViolationEvents(contract);\n        console.log(vaccines, vaccineCount);\n      } catch (err) {\n        showloader(false);\n        console.error(err);\n      }\n      // console.log(\"evets\")\n\n      dispatch({\n        type: actions.init,\n        data: {\n          artifact,\n          web3,\n          accounts,\n          networkID,\n          contract,\n          vaccines\n        }\n      });\n    }\n  }, []);\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/SmartContainer.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n    tryInit();\n  }, [init]);\n  // useEffect(()=>{\n  //   toast.success(\"Checking!!!\")\n  //  },[])\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n      console.log(\"changes\");\n      window.location.reload();\n    };\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n  return /*#__PURE__*/_jsxDEV(EthContext.Provider, {\n    value: {\n      state,\n      dispatch\n    },\n    children: [/*#__PURE__*/_jsxDEV(ToastContainer, {\n      style: {\n        fontSize: \"1.4rem\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), loader ? /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 15\n    }, this) : children]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 5\n  }, this);\n}\n_s(EthProvider, \"0nQTj4FkJ6UmNi2VtEUztbgPmrE=\");\n_c = EthProvider;\nexport default _c2 = /*#__PURE__*/React.memo(EthProvider);\nvar _c, _c2;\n$RefreshReg$(_c, \"EthProvider\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","useState","Web3","EthContext","reducer","actions","initialState","ToastContainer","toast","Spinner","jsxDEV","_jsxDEV","EthProvider","children","_s","state","dispatch","loader","showloader","listenToTheViolationEvents","contract","_contract$events","console","log","events","ViolationEvent","on","evt","returnValues","vio_type","warning","error","listenToTheVaccineEvent","_contract$events2","VaccineChainStep","step","success","init","artifact","web3","givenProvider","accounts","eth","requestAccounts","networkID","net","getId","vaccines","abi","address","_contract","_contract$methods","networks","Contract","vaccineCount","methods","call","from","i","_contract2","_contract2$methods","_contract2$methods$va","res","vaccine","push","id","name","err","type","data","tryInit","require","handleChange","window","location","reload","forEach","e","ethereum","removeListener","Provider","value","style","fontSize","fileName","_jsxFileName","lineNumber","columnNumber","_c","_c2","memo","$RefreshReg$"],"sources":["C:/Users/gpsha/Downloads/vaccine-dapp-main/vaccine-dapp-main/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect, useState } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport { ToastContainer,toast} from 'react-toastify';\nimport {Spinner} from '../../components/Shared';\n\nfunction EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const [loader,showloader]=useState(false);\n  const listenToTheViolationEvents=useCallback(\n    (contract)=>{\n      console.log(\"insideviolation\")\n    contract?.events?.ViolationEvent().on(\"data\",async(evt)=>{\n      if(evt.returnValues){\n        console.log(evt)\n        switch(evt.returnValues.vio_type){\n          case \"1\":\n            return toast.warning(\"Temprature of the container violated\");\n          case \"2\":\n            return toast.warning(\"Container opened while on track\");\n          case \"3\":\n            return toast.warning(\"Container has been exposed to light\"); \n          case \"4\":\n            return toast.warning(\"Container got sidetracked\"); \n            \n                 \n          default:\n            return toast.error(\"Something went wrong\")   \n\n        }\n      //  alert(evt)\n       \n      }\n      \n    })\n  })\n  const listenToTheVaccineEvent=useCallback(\n    (contract)=>{\n    console.log(contract,\"inside vaccine event\")\n    contract?.events?.VaccineChainStep().on(\"data\",async(evt)=>{\n      if(evt.returnValues){\n        console.log(evt)\n        switch(await evt.returnValues.step){\n          case \"0\":\n            return toast.success(\"Not ready for Delivery\");\n          case \"1\":\n            return toast.success(\"Container created and ready for delivery\");\n          case \"2\":\n            return toast.success(\"Container is on its track\"); \n          case \"3\":\n            return toast.success(\"Delivery of container has been ended\"); \n          case \"4\":\n              return toast.success(\"Container has been received\");  \n                 \n          default:\n            return toast.error(\"Something went wrong\")   \n\n        }\n      //  alert(evt)\n       \n      }\n      \n    })\n  })\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        const web3 = new Web3(Web3.givenProvider || \"ws://localhost:7545\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        const vaccines=[];\n        console.log(accounts,\"accounts\")\n        const { abi } = artifact;\n        let address, contract;\n        try {\n          showloader(true)\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n          listenToTheVaccineEvent(contract);\n          const vaccineCount=await contract?.methods?.vaccineCount().call({from:accounts[0]})\n         \n          for(let i=0;i<vaccineCount;i++){\n            const res=await contract?.methods?.vaccine(i)?.call({from:accounts[0]})\n            vaccines.push({id:res.id,name:res.name,state:res.state})\n          }\n\n          showloader(false)\n          listenToTheViolationEvents(contract);\n\n          console.log(vaccines,vaccineCount)\n        } catch (err) {\n          showloader(false)\n          console.error(err);\n        }\n        // console.log(\"evets\")\n    \n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract,vaccines }\n        });\n      \n      }\n    }, []);\n\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/SmartContainer.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n    // useEffect(()=>{\n    //   toast.success(\"Checking!!!\")\n    //  },[])\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n      console.log(\"changes\")\n      window.location.reload();\n    };\n\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      <ToastContainer style={{ fontSize:\"1.4rem\" }} />\n      {loader?<Spinner />:children}\n    </EthContext.Provider>\n  );\n}\n\nexport default React.memo(EthProvider);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}